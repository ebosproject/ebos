<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:eb="http://java.sun.com/jsf/composite/componentes/ebos">

    <ui:param name="westRendered" value="true" />
    <ui:param name="showAuditoria" value="true" />

	<h:form id="frmExplorer" prependId="false">
	   	<p:panel id="pnlContFilters" header="#{msg.ebFiltros}" toggleable="true" 
	   		toggleOrientation="horizontal" style="height:100%;width:220px;">
	          	<f:facet name="actions">
		           	<p:commandButton id="btnSearch" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default" actionListener="#{bean._buscar}" title="#{msg.ebBuscar}" 
		                	icon="ui-icon-search" update="pnlContResults" process="@parent" 
		                	style="height:18px"/>
	          	</f:facet>
	           <ui:insert name="filtros"/>
	    </p:panel>
    
        <p:panel id="pnlContResults" header="#{optionName}" style="position:absolute;top:0px;left:220px;right:0px;height:100%;width:75%">
           	<f:facet name="actions">
                <p:commandButton id="btnNuevo" title="#{msg.ebNuevo}" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default" rendered="#{bean.habilitaCrear}"
                                 action="#{bean._crear}" icon="ui-icon-document" style="height:18px"/>
                <p:commandButton id="btnEditar" title="#{msg.ebEditar}" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default" action="#{bean._editar}" rendered="#{bean.habilitaEditar and not empty bean.dataTable}"
                                 icon="ui-icon-edit" style="height:18px"/>                    
                <p:commandButton id="btnExportar" value="#{msg.ebExportar}" styleClass="ui-panel-titlebar-icon ui-corner-all ui-state-default" rendered="#{bean.habilitaExportar}"
                	style="height:18px">
                    <p:dataExporter type="xls" target="dtR" fileName="Reporte" />
                </p:commandButton>
                
                <p:remoteCommand id="fnEditar" action="#{bean._editar}" name="fnEditar" 
	         		rendered="#{bean.habilitaEditar and not empty bean.dataTable}" style="height:18px"/>
            </f:facet>
	        
        	<p:dataTable id="dtR" 
        		var="reg" 
            	value="#{bean.dataTable}"
	            lazy="true" 
	            selectionMode="single"
	            selection="#{bean.activeEntity}"
	            paginator="true" 
	            paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"  
	            rowsPerPageTemplate="5,10,15,50"
	            rows="10" 
	            emptyMessage="#{msg.ebEmptyDataTable}"
	            resizableColumns="true"
	            scrollable="true"  
	            scrollHeight="100%"
	            rowKey="#{reg.id}">

				<p:ajax event="rowDblselect" disabled="#{not(bean.habilitaEditar and not empty bean.dataTable)}" 
					oncomplete="wgtEdit.show()" update="@(display)"/>  
  
	            <p:column headerText="#{msg.ebId}" width="30" style="text-align:center" rendered="#{bean.habilitaEditar}" resizable="false" >
	                 <p:commandLink id="cmlEditar" type="push" value="#{reg.id}" 
	                 	action="#{bean._editar}" ajax="false" style="color:blue"
	                     title="#{msg.ebVer}" onmouseup="jsPreventDefault(event,this);">
	                     <f:setPropertyActionListener value="#{reg}" target="#{bean.activeEntity}"/>
	                 </p:commandLink>
	            </p:column>
	             
	            <ui:insert name="resultados" />
	             
			    <p:column id="creado" headerText="#{msg.ebCreado}" width="60" resizable="false" rendered="#{showAuditoria}">        
			        <eb:outputDate value="#{reg.fechaCreacion}" title="#{msg.ebPor}: #{reg.usuarioCreacion.username}"/>
			    </p:column>
			    <p:column id="modificado" headerText="#{msg.ebModificado}" width="60" resizable="false" rendered="#{showAuditoria}">        
			        <eb:outputDate value="#{reg.fechaModificacion}" title="#{msg.ebPor}: #{reg.usuarioModificacion.username}"/>
			    </p:column>                    
	     	</p:dataTable>
	     	
	     	<p:dialog widgetVar="wgtEdit" closeOnEscape="true" draggable="true" closable="true" dynamic="true" 
	     		height="150" width="200" header="#{msg.ebEdit}" showEffect="explode" hideEffect="explode">
				
				<h:panelGrid id="display" columns="2" cellpadding="4">  
		    		#{bean.activeEntity.id}
		        </h:panelGrid>
		        
	   		</p:dialog>
	
	     	<p:blockUI block="dtR" trigger="btnSearch" />
	     	
    	</p:panel>
    </h:form> 
</ui:composition>
